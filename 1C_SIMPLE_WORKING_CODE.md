# ПРОСТИЙ РОБОЧИЙ КОД 1C (БЕЗ ПОМИЛОК)

## Виправлено:
- ✅ Прибрано поле "Статус" з запиту (такого поля не існує)
- ✅ Файлове логування замість журналу реєстрації  
- ✅ Правильний синтаксис ЗаписатьJSON
- ✅ Правильне поле валюти: ВалютаДокумента.Код

## МІНІМАЛЬНИЙ РОБОЧИЙ КОД:

```1c
Функция invoicesPOST(Запрос)
    
    Попытка
        ЗаписатьВФайл("=== НОВЫЙ ЗАПРОС НАКЛАДНЫХ ===");
        
        МассивНакладных = ПолучитьДанныеНакладных(50);
        
        ЗаписатьВФайл("Найдено накладных: " + Строка(МассивНакладных.Количество()));
        
        // JSON
        ЗаписьJSON = Новый ЗаписьJSON;
        ЗаписьJSON.УстановитьСтроку();
        ЗаписатьJSON(ЗаписьJSON, МассивНакладных);
        СтрокаJSON = ЗаписьJSON.Закрыть();
        
        // Ответ
        Ответ = Новый HTTPСервисОтвет(200);
        Ответ.УстановитьТелоИзСтроки(СтрокаJSON, КодировкаТекста.UTF8);
        Ответ.Заголовки.Вставить("Content-Type", "application/json; charset=utf-8");
        
        ЗаписатьВФайл("SUCCESS: Отправлено накладных: " + Строка(МассивНакладных.Количество()));
        
        Возврат Ответ;
        
    Исключение
        ЗаписатьВФайл("ERROR в invoicesPOST: " + ОписаниеОшибки());
        
        ОтветОшибка = Новый HTTPСервисОтвет(500);
        ОтветОшибка.УстановитьТелоИзСтроки("Error: " + ОписаниеОшибки(), КодировкаТекста.UTF8);
        Возврат ОтветОшибка;
        
    КонецПопытки;
    
КонецФункции

Функция ПолучитьДанныеНакладных(КоличествоЗаписей = 50)
    
    МассивНакладных = Новый Массив;
    
    Попытка
        ЗаписатьВФайл("Начинаем поиск накладных...");
        
        ДатаНачала = НачалоДня(ТекущаяДата() - 30*24*3600);
        ЗаписатьВФайл("Период с: " + Строка(ДатаНачала));
        
        Запрос = Новый Запрос;
        Запрос.Текст = "
        |ВЫБРАТЬ ПЕРВЫЕ " + КоличествоЗаписей + "
        |    Ссылка КАК ДокументСсылка,
        |    Номер,
        |    Дата,
        |    Контрагент.Наименование КАК КонтрагентНаименование,
        |    СуммаДокумента,
        |    ВалютаДокумента.Код КАК КодВалюты,
        |    Проведен
        |ИЗ Документ.ПоступлениеТоваровУслуг КАК ПоступлениеТоваровУслуг
        |ГДЕ ПоступлениеТоваровУслуг.Дата >= &ДатаНачала
        |    И ПоступлениеТоваровУслуг.Проведен = ИСТИНА
        |УПОРЯДОЧИТЬ ПО Дата УБЫВ";
        
        Запрос.УстановитьПараметр("ДатаНачала", ДатаНачала);
        
        ЗаписатьВФайл("Выполняем SQL запрос...");
        
        Результат = Запрос.Выполнить();
        Выборка = Результат.Выбрать();
        
        ЗаписатьВФайл("SQL выполнен успешно");
        
        Счетчик = 0;
        Пока Выборка.Следующий() Цикл
            
            Счетчик = Счетчик + 1;
            
            ЗаписатьВФайл("Накладная " + Строка(Счетчик) + ": " + Выборка.Номер + " от " + Строка(Выборка.Дата));
            
            ОбъектНакладной = Новый Структура;
            ОбъектНакладной.Вставить("ID", Строка(Выборка.ДокументСсылка.УникальныйИдентификатор()));
            ОбъектНакладной.Вставить("НомерДокумента", Выборка.Номер);
            ОбъектНакладной.Вставить("Дата", Формат(Выборка.Дата, "ДФ=yyyy-MM-dd"));
            ОбъектНакладной.Вставить("Постачальник", Выборка.КонтрагентНаименование);
            ОбъектНакладной.Вставить("Сума", Число(Выборка.СуммаДокумента));
            ОбъектНакладной.Вставить("Валюта", Выборка.КодВалюты);
            ОбъектНакладной.Вставить("Статус", "confirmed");
            
            // Позиции документа
            МассивПозиций = ПолучитьПозицииДокумента(Выборка.ДокументСсылка);
            ОбъектНакладной.Вставить("Позиції", МассивПозиций);
            
            МассивНакладных.Добавить(ОбъектНакладной);
            
        КонецЦикла;
        
        ЗаписатьВФайл("=== ИТОГО НАЙДЕНО: " + Строка(Счетчик) + " накладных ===");
        
    Исключение
        ЗаписатьВФайл("ERROR в ПолучитьДанныеНакладных: " + ОписаниеОшибки());
    КонецПопытки;
    
    Возврат МассивНакладных;
    
КонецФункции

Функция ПолучитьПозицииДокумента(ДокументСсылка)
    
    МассивПозиций = Новый Массив;
    
    Попытка
        
        Запрос = Новый Запрос;
        Запрос.Текст = "
        |ВЫБРАТЬ
        |    Номенклатура.Наименование КАК НазваТовару,
        |    Номенклатура.Артикул КАК Артикул,
        |    Количество,
        |    Цена,
        |    Сумма,
        |    ЕдиницаИзмерения.Наименование КАК ЕдиницаИзмерения
        |ИЗ Документ.ПоступлениеТоваровУслуг.Товары КАК ТоварыДокумента
        |ГДЕ ТоварыДокумента.Ссылка = &ДокументСсылка";
        
        Запрос.УстановитьПараметр("ДокументСсылка", ДокументСсылка);
        
        Результат = Запрос.Выполнить();
        Выборка = Результат.Выбрать();
        
        Пока Выборка.Следующий() Цикл
            
            ОбъектПозиции = Новый Структура;
            ОбъектПозиции.Вставить("НазваТовару", Выборка.НазваТовару);
            ОбъектПозиции.Вставить("Артикул", Выборка.Артикул);
            ОбъектПозиции.Вставить("Кількість", Число(Выборка.Количество));
            ОбъектПозиции.Вставить("Ціна", Число(Выборка.Цена));
            ОбъектПозиции.Вставить("Сума", Число(Выборка.Сумма));
            ОбъектПозиции.Вставить("ОдиницяВиміру", Выборка.ЕдиницаИзмерения);
            
            МассивПозиций.Добавить(ОбъектПозиции);
            
        КонецЦикла;
        
    Исключение
        ЗаписатьВФайл("ERROR позиций: " + ОписаниеОшибки());
    КонецПопытки;
    
    Возврат МассивПозиций;
    
КонецФункции

// ФАЙЛОВЕ ЛОГУВАННЯ
Процедура ЗаписатьВФайл(Текст)
    
    Попытка
        
        ИмяФайла = "c:\temp\erp_debug.txt";
        
        ФайлКаталог = Новый Файл("c:\temp");
        Если НЕ ФайлКаталог.Существует() Тогда
            СоздатьКаталог("c:\temp");
        КонецЕсли;
        
        ТекстовыйДокумент = Новый ТекстовыйДокумент;
        
        ФайлЛога = Новый Файл(ИмяФайла);
        Если ФайлЛога.Существует() Тогда
            ТекстовыйДокумент.Прочитать(ИмяФайла, КодировкаТекста.UTF8);
        КонецЕсли;
        
        СтрокаЛога = Формат(ТекущаяДата(), "ДФ=dd.MM.yyyy ВФ=HH:mm:ss") + " | " + Текст;
        ТекстовыйДокумент.ДобавитьСтроку(СтрокаЛога);
        
        ТекстовыйДокумент.Записать(ИмяФайла, КодировкаТекста.UTF8);
        
    Исключение
        // Ігноруємо помилки логування
    КонецПопытки;
    
КонецПроцедуры
```

## РЕЗУЛЬТАТ:

Після встановлення цього коду в файлі `c:\temp\erp_debug.txt` ви побачите:
- Скільки накладних знайдено
- Які саме накладні (номер та дата)
- Детальні логи всіх операцій
- Повну діагностику помилок

Цей код має працювати без помилок!