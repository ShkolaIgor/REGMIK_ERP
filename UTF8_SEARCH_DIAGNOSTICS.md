# Nova Poshta UTF-8 Search Diagnostics Report

## –ü—Ä–æ–±–ª–µ–º–∞
–£ production —Å–∏—Å—Ç–µ–º—ñ –ø–æ—à—É–∫ "—á–µ" –ø–æ–≤–µ—Ä—Ç–∞—î 162 –º—ñ—Å—Ç, —Ç–æ–¥—ñ —è–∫ —É development - 1,451 –º—ñ—Å—Ç.

## –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Development
```json
{
  "totalCities": 10558,
  "totalWarehouses": 40443,
  "searchQuery": "—á–µ",
  "apiResults": 1451,
  "directSqlResults": "1451",
  "encoding": {
    "server_encoding": "UTF8",
    "client_encoding": "UTF8"
  },
  "environment": "development",
  "timestamp": "2025-06-14T19:34:33.709Z"
}
```

## –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è UTF-8
‚úÖ **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö:**
- –î–æ–¥–∞–Ω–æ `client_encoding: 'UTF8'` –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é pool
- –î–æ–¥–∞–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫ `pool.on('connect')` –¥–ª—è –≥–∞—Ä–∞–Ω—Ç—É–≤–∞–Ω–Ω—è UTF-8
- –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ –∑–º—ñ–Ω–∏ –≤ `server/db.ts` —Ç–∞ `deployment-package/server/db.ts`

## –ü—Ä–∏—á–∏–Ω–∞ —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ
–†—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ development (1,451) —Ç–∞ production (162) —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≤–∫–∞–∑—É—î –Ω–∞:

1. **–ù–µ–ø–æ–≤–Ω—ñ –¥–∞–Ω—ñ –≤ production –±–∞–∑—ñ** - –º–µ–Ω—à–µ –∑–∞–≥–∞–ª—å–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ Nova Poshta
2. **–ó–∞—Å—Ç–∞—Ä—ñ–ª—É –≤–µ—Ä—Å—ñ—é –¥–∞–Ω–∏—Ö** - –º–æ–∂–ª–∏–≤–æ, —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –Ω–µ –≤—ñ–¥–±—É–ª–∞—Å—è –ø–æ–≤–Ω—ñ—Å—Ç—é
3. **–†—ñ–∑–Ω—ñ –≤–µ—Ä—Å—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö** - development –º–∞—î —Å–≤—ñ–∂—ñ—à—ñ –¥–∞–Ω—ñ

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è production

### 1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö
```bash
curl -s "http://your-production-url/api/nova-poshta/diagnostics?q=—á–µ"
```

### 2. –ü—Ä–∏–Ω—É–¥–æ–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
–Ø–∫—â–æ –≤ production –º–µ–Ω—à–µ –¥–∞–Ω–∏—Ö, –ø–æ—Ç—Ä—ñ–±–Ω–æ:
- –í–∏–∫–æ–Ω–∞—Ç–∏ –ø–æ–≤–Ω—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é Nova Poshta
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å Nova Poshta API –∑ production —Å–µ—Ä–≤–µ—Ä–∞

### 3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
```sql
SELECT COUNT(*) FROM nova_poshta_cities;
SELECT COUNT(*) FROM nova_poshta_warehouses;
```

## Endpoint –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
–î–æ–¥–∞–Ω–æ `/api/nova-poshta/diagnostics` –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É:
- –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –º—ñ—Å—Ç —ñ –≤—ñ–¥–¥—ñ–ª–µ–Ω—å
- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É —á–µ—Ä–µ–∑ API —Ç–∞ SQL
- –°—Ç–∞—Ç—É—Å –∫–æ–¥—É–≤–∞–Ω–Ω—è UTF-8
- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ

## –ö–æ—Ä—ñ–Ω—å –ø—Ä–æ–±–ª–µ–º–∏ –≤–∏—è–≤–ª–µ–Ω–æ
**Production –ø—Ä–æ–±–ª–µ–º–∞:** `client_encoding: SQL_ASCII` –∑–∞–º—ñ—Å—Ç—å `UTF8`

## –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–æ
‚úÖ **–ü–æ–ª—ñ–ø—à–µ–Ω–æ database connection handler:**
```javascript
pool.on('connect', async (client) => {
  try {
    await client.query('SET client_encoding TO "UTF8"');
    await client.query('SET standard_conforming_strings TO on');
    console.log('Database connection configured for UTF-8');
  } catch (error) {
    console.error('Error setting UTF-8 encoding:', error);
  }
});
```

## –°—Ç–∞—Ç—É—Å UTF-8
‚úÖ **Development:** –ü–æ–≤–Ω—ñ—Å—Ç—é —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π (UTF8/UTF8)
üîß **Production:** –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≥–æ—Ç–æ–≤–µ –¥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

## –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤ production
–°—Ç–≤–æ—Ä–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–∏–π —Å–∫—Ä–∏–ø—Ç `fix-utf8-production.sh`:
- –ó—É–ø–∏–Ω—è—î —Å–ª—É–∂–±—É
- –°—Ç–≤–æ—Ä—é—î —Ä–µ–∑–µ—Ä–≤–Ω—É –∫–æ–ø—ñ—é
- –†–æ–∑–≥–æ—Ä—Ç–∞—î –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è UTF-8
- –ó–∞–ø—É—Å–∫–∞—î —Å–ª—É–∂–±—É
- –¢–µ—Å—Ç—É—î —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å

## –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø—ñ—Å–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
- Production `client_encoding` –∑–º—ñ–Ω–∏—Ç—å—Å—è –∑ `SQL_ASCII` –Ω–∞ `UTF8`
- –ü–æ—à—É–∫ "—á–µ" –ø–æ–≤–∏–Ω–µ–Ω –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ 1,451 –º—ñ—Å—Ç (—è–∫ —É development)
- –ü–æ—à—É–∫ "–ß–µ—Ä–Ω—ñ–≥—ñ–≤" –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ –∫–æ—Ä–µ–∫—Ç–Ω–æ
- –î—ñ–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–∏–π endpoint –ø–æ–∫–∞–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è