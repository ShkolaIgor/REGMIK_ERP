# Диагностика параметров HTTP запросов в 1С

## Проблема
При получении параметров URL в функции `ПолучитьНакладные(Запрос)` объект `Запрос.ПараметрыURL` возвращает `ФиксированноеСоответствие`, а не отдельные свойства.

## Правильный код для работы с параметрами

```1c
Функция ПолучитьНакладные(Запрос) Экспорт
    
    // Логирование для диагностики
    ИмяФайла = КаталогВременныхФайлов() + "erp_debug.txt";
    Записывач = Новый ЗаписьТекста(ИмяФайла, КодировкаТекста.UTF8);
    Записывач.ЗаписатьСтроку("=== Диагностика HTTP запроса ===");
    Записывач.ЗаписатьСтроку("Время: " + Формат(ТекущаяДата(), "ДФ='dd.MM.yyyy HH:mm:ss'"));
    
    // Получаем параметры из запроса
    ДатаОт = "";
    ДатаДо = "";
    
    // Запрос.ПараметрыURL это ФиксированноеСоответствие
    Записывач.ЗаписатьСтроку("Тип ПараметрыURL: " + ТипЗнч(Запрос.ПараметрыURL));
    Записывач.ЗаписатьСтроку("Количество параметров: " + Запрос.ПараметрыURL.Количество());
    
    // ПРАВИЛЬНЫЙ способ работы с ФиксированноеСоответствие
    Для Каждого Параметр Из Запрос.ПараметрыURL Цикл
        Записывач.ЗаписатьСтроку("Параметр: " + Параметр.Ключ + " = " + Параметр.Значение);
        
        Если Параметр.Ключ = "dateFrom" Тогда
            ДатаОт = Параметр.Значение;
        ИначеЕсли Параметр.Ключ = "dateTo" Тогда
            ДатаДо = Параметр.Значение;
        КонецЕсли;
    КонецЦикла;
    
    // Альтернативный способ (если поддерживается вашей версией 1С):
    // ДатаОт = Запрос.ПараметрыURL.Получить("dateFrom");
    // ДатаДо = Запрос.ПараметрыURL.Получить("dateTo");
    
    Записывач.ЗаписатьСтроку("Получены даты: от=" + ДатаОт + ", до=" + ДатаДо);
    Записывач.Закрыть();
    
    // Теперь создаем результат
    Результат = Новый Массив;
    
    // Пример создания тестовой накладной
    ТестоваяНакладная = Новый Структура;
    ТестоваяНакладная.Вставить("ID", "test-001");
    ТестоваяНакладная.Вставить("НомерДокумента", "TEST-" + Формат(ТекущаяДата(), "ДФ=yyyyMMdd"));
    ТестоваяНакладная.Вставить("Дата", Формат(ТекущаяДата(), "ДФ=yyyy-MM-dd"));
    ТестоваяНакладная.Вставить("Поставщик", "Тестовый поставщик");
    ТестоваяНакладная.Вставить("Сумма", 1000);
    ТестоваяНакладная.Вставить("Валюта", "UAH");
    ТестоваяНакладная.Вставить("Статус", "new");
    
    // Добавляем тестовые позиции
    Позиции = Новый Массив;
    ТестоваяПозиция = Новый Структура;
    ТестоваяПозиция.Вставить("Название", "Тестовый товар");
    ТестоваяПозиция.Вставить("Количество", 1);
    ТестоваяПозиция.Вставить("Цена", 1000);
    ТестоваяПозиция.Вставить("Сумма", 1000);
    ТестоваяПозиция.Вставить("ЕдиницаИзмерения", "шт");
    Позиции.Добавить(ТестоваяПозиция);
    
    ТестоваяНакладная.Вставить("Позиции", Позиции);
    Результат.Добавить(ТестоваяНакладная);
    
    Возврат Результат;
КонецФункции
```

## Проверка работы

1. Добавьте этот код в HTTP-сервис 1С
2. Опубликуйте сервис
3. Протестируйте через ERP систему
4. Проверьте файл `erp_debug.txt` в папке временных файлов 1С

## Возможные проблемы

### HTTP 405 Method Not Allowed
- Убедитесь что HTTP-сервис настроен на прием POST запросов
- Проверьте что ресурс `invoices` создан и опубликован

### Авторизация не работает (показывает "Анонимная")
- Настройте Basic аутентификацию в настройках HTTP-сервиса
- Проверьте права пользователя на доступ к веб-сервисам

### Файл erp_debug.txt не создается
- Проверьте права на запись в папку временных файлов
- Убедитесь что функция вызывается (проверьте логи IIS)

## Следующие шаги после устранения ошибки

1. Замените тестовые данные на реальные запросы к документам 1С
2. Добавьте фильтрацию по датам `ДатаОт` и `ДатаДо`
3. Настройте правильные поля для вашей конфигурации 1С