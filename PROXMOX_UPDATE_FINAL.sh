#!/bin/bash

# REGMIK ERP - –§—ñ–Ω–∞–ª—å–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è Proxmox –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ü–µ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ –Ω–∞ 192.168.0.247:5000

echo "üöÄ REGMIK ERP - –§—ñ–Ω–∞–ª—å–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏"
echo "=========================================="

# –ó—É–ø–∏–Ω—è—î–º–æ —Å–µ—Ä–≤—ñ—Å
echo "‚èπÔ∏è  –ó—É–ø–∏–Ω—è—î–º–æ —Å–µ—Ä–≤—ñ—Å..."
sudo systemctl stop regmik-erp

# –°—Ç–≤–æ—Ä—é—î–º–æ backup –ø–æ—Ç–æ—á–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó
echo "üíæ –°—Ç–≤–æ—Ä—é—î–º–æ backup..."
sudo cp -r /opt/REGMIK_ERP /opt/REGMIK_ERP_backup_$(date +%Y%m%d_%H%M%S)

# –û–Ω–æ–≤–ª—é—î–º–æ —Ñ–∞–π–ª–∏
echo "üì• –û–Ω–æ–≤–ª—é—î–º–æ —Ñ–∞–π–ª–∏ —Å–∏—Å—Ç–µ–º–∏..."
cd /opt/REGMIK_ERP

# –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω—É –≤–µ—Ä—Å—ñ—é –∑ production build
echo "üì¶ –ö–æ–ø—ñ—é—î–º–æ production build..."
sudo cp -r dist/* /opt/REGMIK_ERP/

# –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É
echo "üîê –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É..."
sudo chown -R regmik:regmik /opt/REGMIK_ERP
sudo chmod +x /opt/REGMIK_ERP/start-production.sh

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î–º–æ —Å–µ—Ä–≤—ñ—Å
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î–º–æ —Å–µ—Ä–≤—ñ—Å..."
sudo systemctl daemon-reload
sudo systemctl start regmik-erp
sudo systemctl enable regmik-erp

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å
echo "‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤—ñ—Å—É..."
sleep 3
sudo systemctl status regmik-erp --no-pager

echo ""
echo "üéâ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo "üìç –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–Ω–∏–π: http://192.168.0.247:5000"
echo "üìß –ú–æ–¥—É–ª—å '–ö–æ—Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ü—ñ—è –∫–ª—ñ—î–Ω—Ç—ñ–≤' —Ç–µ–ø–µ—Ä –¥–æ—Å—Ç—É–ø–Ω–∏–π –≤ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ"
echo ""
echo "üîß –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∫–æ–º–∞–Ω–¥–∏:"
echo "   sudo systemctl status regmik-erp    # —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤—ñ—Å—É"
echo "   sudo systemctl restart regmik-erp   # –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫"
echo "   sudo journalctl -u regmik-erp -f    # –ø–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤"